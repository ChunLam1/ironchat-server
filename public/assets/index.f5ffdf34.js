var O=Object.defineProperty,W=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var A=(t,n,s)=>n in t?O(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,L=(t,n)=>{for(var s in n||(n={}))H.call(n,s)&&A(t,s,n[s]);if(I)for(var s of I(n))P.call(n,s)&&A(t,s,n[s]);return t},N=(t,n)=>W(t,j(n));import{r as c,a as X,j as b,u as F,R as T,F as D,f as G,N as x,L as R,b as J,O as Y,l as Q,c as V,d as z,e as S,g as q,B as Z}from"./vendor.7a6aa371.js";const K=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}};K();const w=c.exports.createContext(),v=()=>c.exports.useContext(w);const y=X.create({baseURL:"https://deploy-ironchat.herokuapp.com",withCredentials:!0});//! Error handling to use in the catch
function E(t){throw t.response.data&&console.log(t.response&&t.response.data),t}const p=N(L({},y),{signup(t){return y.post("/api/auth/signup",t).then(n=>n.data).catch(E)},isLoggedIn(t){return y.get("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}}).then(n=>n.data).catch(E)},signin(t){return y.post("/api/auth/signin",t).then(n=>n.data).catch(E)}}),e=b.exports.jsx,o=b.exports.jsxs,f=b.exports.Fragment,M=({userId:t})=>{const[n,s]=c.exports.useState("");return e(f,{children:e("form",{onSubmit:async r=>{r.preventDefault();try{await p.post("/server",{name:n,participants:t,admins:t})}catch{console.error(r)}},children:o("div",{children:[e("label",{htmlFor:"name",children:"Server's name"}),e("input",{type:"text",name:"name",value:n,onChange:r=>s(r.target.value)}),e("button",{children:"Create server"})]})})})},$=()=>{const{isLoading:t,currentUser:n,isLoggedIn:s,removeUser:i}=v(),[r,a]=c.exports.useState("");return c.exports.useEffect(async()=>{if(!t)try{a(n._id)}catch(u){console.error(u)}},[t]),e("nav",{className:"NavMain",children:s&&e(f,{children:e("button",{onClick:i,children:"Log-Out"})})})},k=t=>{const[n,s]=c.exports.useState(t);return[n,r=>{s(N(L({},n),{[r.target.name]:r.target.value}))}]},_=()=>{const[{email:t,password:n},s]=k({email:"",password:""}),[i,r]=c.exports.useState(null),a=F(),{storeToken:u,authenticateUser:h}=v(),m=d=>{d.preventDefault(),p.signin({email:t,password:n}).then(l=>{u(l.authToken),h(),a("/")}).catch(l=>{r(l.response.data)})};return o("div",{className:"signinForm",children:[i&&e("h3",{className:"error",children:i.message}),e("h2",{children:"Signin"}),o("form",{onSubmit:m,className:"form1",children:[o("div",{children:[e("label",{htmlFor:"email",children:"Email: "}),e("input",{className:"signinput",type:"email",id:"email",name:"email",onChange:s,value:t,autoComplete:"username"})]}),o("div",{children:[e("label",{htmlFor:"password",children:"Password: "}),e("input",{className:"signinput",type:"password",id:"password",name:"password",onChange:s,value:n,autoComplete:"current-password"})]}),e("button",{className:"btnsub",children:"Submit"})]})]})},ee=()=>{const[t,n]=k({name:"",email:"",password:""}),[s,i]=c.exports.useState(null),r=F(),a=u=>{u.preventDefault(),p.signup(t).then(()=>{r("/signin")}).catch(h=>{i(h.response.data)})};return o("div",{className:"signinForm",children:[s&&e("h3",{className:"error",children:s.message}),e("h2",{children:"Signup"}),o("form",{onSubmit:a,className:"form1",children:[o("div",{children:[e("label",{htmlFor:"name",children:"Name :"}),e("input",{className:"signinput",onChange:n,value:t.name,type:"text",id:"name",name:"name"})]}),o("div",{children:[e("label",{htmlFor:"email",children:"Email :"}),e("input",{className:"signinput",onChange:n,value:t.email,type:"email",id:"email",name:"email"})]}),o("div",{children:[e("label",{htmlFor:"password",children:"Password :"}),e("input",{className:"signinput",onChange:n,value:t.password,type:"password",id:"password",name:"password"})]}),e("button",{className:"btnsub",children:"Submit"})]})]})};var te="data:image/png;base64,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";function ne({clbk:t,avatar:n=""}){const s=T.createRef();return o("div",{className:"is-clickable icon-avatar",title:"change avatar",children:[n&&e("img",{style:{width:250},src:n,alt:"user avatar"}),e("input",{ref:s,type:"file",onChange:t}),e(D,{onClick:()=>{s.current.click()},className:"is-clickable fa-lg",icon:G})]})}const se=()=>{const{currentUser:t,storeToken:n}=v(),[{name:s,image:i,imageTmp:r},a]=c.exports.useState({name:t.name,image:"",imageTmp:""}),u=t._id,h=l=>{l.persist(),a(g=>N(L({},g),{[l.target.id]:l.target.value}))},m=async l=>{l.preventDefault();const g=new FormData;g.append("name",s),g.append("image",i),console.log(g);try{await p.patch(`/profile/${u}`,g).then(({data:C})=>{n(C.newAuthToken)})}catch(C){console.error(C)}},d=l=>{const g=new FileReader;g.onloadend=()=>{const C=g.result;a(B=>N(L({},B),{image:l,imageTmp:C}))},g.readAsDataURL(l)};return o("div",{children:[e(x,{className:"logo",to:"/",children:"IronChat"}),o("form",{onSubmit:m,onChange:h,children:[e("label",{className:"label",htmlFor:"image"}),e(ne,{avatar:r||i,clbk:l=>d(l.target.files[0]),id:"image"}),e("input",{style:{borderRadius:"50px",border:"none",cursor:"pointer"},type:"text",defaultValue:s,id:"name",name:"name"}),e("button",{style:{borderRadius:"50px"},children:"Ok!!"})]})]})},re=()=>{const[t,n]=c.exports.useState(!1),[s,i]=c.exports.useState([]),{isLoggedIn:r}=v();return c.exports.useEffect(()=>{p.get("/server/").then(a=>{i(a.data.server)}).catch(a=>console.log(a))},[]),e(f,{children:e("div",{className:"server",children:r?o("div",{children:[o("div",{className:"navLP",children:[e("div",{className:"divLogo",children:e(x,{className:"logo",to:"/",children:"IronChat"})}),e("div",{children:e(R,{to:"/profile",children:e("i",{className:"fas fa-user-circle",style:{fontSize:"30px"}})})})]}),e("div",{className:"serverContainer",children:s.map((a,u)=>e("div",{className:"serverContainerChild",children:o(R,{to:`/server/${a._id}`,children:[e("img",{className:"serverLogo",src:te,alt:"serverLogo"}),e("p",{className:"serverIcone",children:a.name})]},a._id)},u))})]}):e(f,{children:e("div",{className:"home",children:t?o(f,{children:[e(ee,{}),e("span",{className:"register",onClick:()=>n(!t),children:"Already have an account?"})]}):o(f,{children:[e(_,{}),e("span",{className:"register",onClick:()=>n(!t),children:"Don't have an account?"})]})})})})})},ae=()=>{const{isLoggedIn:t,isLoading:n}=v();return n?e("p",{children:"Loading..."}):t?e(Y,{}):e(J,{to:"/signin"})};const U=Q("http://localhost:8080"),oe=()=>{const[t,n]=c.exports.useState([]),[s,i]=c.exports.useState({}),r=c.exports.useRef(""),a=V(),{currentUser:u}=v(),h=d=>{console.log("je suis fetchmEssage et j'ai recu",d),p.get(`${{}.SOCKET_URL}/server/${a.id}/messages`||`http://localhost:8080/server/${a.id}/messages`).then(l=>n(l.data.messages)).catch(l=>console.error(l))};c.exports.useEffect(()=>{p.get(`${{}.SOCKET_URL}/server/${a.id}`||`http://localhost:8080/server/${a.id}`).then(d=>{U.on("message-stored",h),i(d.data.server)}).catch(d=>console.error(d))},[]),c.exports.useEffect(()=>{h()},[s]);const m=d=>{d.preventDefault();const l=r.current.value;U.emit("message",{serverId:a.id,userId:u._id,content:l}),r.current.value=""};return o("div",{children:[o("div",{className:"navLP",children:[e("div",{className:"divLogo",children:e(x,{className:"logo",to:"/",children:"IronChat"})}),e("div",{children:e(R,{to:"/profile",children:e("i",{className:"fas fa-user-circle",style:{fontSize:"30px"}})})})]}),o("h1",{children:["Server name: ",s.name]}),e("ul",{id:"messages",children:t.map(d=>o("li",{children:[o("b",{children:[d.userId.name," : "]}),d.content]},d._id))}),o("form",{id:"form",onSubmit:m,children:[e("input",{id:"input",autoComplete:"off",ref:r}),e("button",{children:"Send"})]})]})};function ie(){return o("div",{className:"App",children:[o(z,{children:[e(S,{path:"/",element:e(re,{})}),o(S,{element:e(ae,{}),children:[e(S,{path:"/server/:id",element:e(oe,{})}),e(S,{path:"/profile",element:e(se,{})})]})]}),e(M,{}),e($,{})]})}const le=({children:t})=>{const[n,s]=c.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});c.exports.useEffect(()=>{i()},[]);const i=()=>{const m=localStorage.getItem("authToken");m?p.isLoggedIn(m).then(d=>{s({currentUser:d,isLoading:!1,isLoggedIn:!0})}).catch(d=>{s({currentUser:null,isLoading:!1,isLoggedIn:!1})}):s({currentUser:null,isLoading:!1,isLoggedIn:!1})},r=()=>{a(),i()},a=()=>{localStorage.removeItem("authToken")},u=m=>{localStorage.setItem("authToken",m),i()},h={currentUser:n.currentUser,isLoading:n.isLoading,isLoggedIn:n.isLoggedIn,removeUser:r,storeToken:u,authenticateUser:i};return e(w.Provider,{value:h,children:t})};q.render(e(T.StrictMode,{children:e(Z,{children:e(le,{children:e(ie,{})})})}),document.getElementById("root"));
