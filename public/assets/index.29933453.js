var q=Object.defineProperty,M=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var O=(s,t,n)=>t in s?q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n,x=(s,t)=>{for(var n in t||(t={}))K.call(t,n)&&O(s,n,t[n]);if(U)for(var n of U(t))_.call(t,n)&&O(s,n,t[n]);return s},b=(s,t)=>M(s,Z(t));import{r as l,a as $,j as A,u as W,R as j,F as ee,f as se,N as P,L as te,b as ne,O as ae,l as re,c as oe,d as ie,e as R,g as le,B as ce}from"./vendor.7a6aa371.js";const de=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}};de();const H=l.exports.createContext(),L=()=>l.exports.useContext(H);console.log("hip","https://deploy-ironchat.herokuapp.com");const I=$.create({baseURL:"https://deploy-ironchat.herokuapp.com",withCredentials:!0});//! Error handling to use in the catch
function w(s){throw s.response.data&&console.log(s.response&&s.response.data),s}const f=b(x({},I),{signup(s){return I.post("/api/auth/signup",s).then(t=>t.data).catch(w)},isLoggedIn(s){return I.get("/api/auth/me",{headers:{Authorization:`Bearer ${s}`}}).then(t=>t.data).catch(w)},signin(s){return I.post("/api/auth/signin",s).then(t=>t.data).catch(w)}}),e=A.exports.jsx,o=A.exports.jsxs,N=A.exports.Fragment,ue=({userId:s,setServers:t,closeServer:n})=>{const[i,a]=l.exports.useState("");return o(N,{children:[e("i",{className:"fas fa-close",onClick:n}),e("form",{onSubmit:async d=>{d.preventDefault();try{const p=await f.post("/server",{name:i,participants:s,admins:s});t(u=>[...u,p.data])}catch{console.error(d)}},children:o("div",{className:"createServer-form",children:[e("label",{htmlFor:"name",children:"Server's name"}),e("input",{type:"text",name:"name",value:i,onChange:d=>a(d.target.value)}),e("button",{children:"Create server"})]})})]})},X=()=>{const{isLoading:s,currentUser:t,isLoggedIn:n,removeUser:i}=L(),[a,r]=l.exports.useState("");return l.exports.useEffect(async()=>{if(!s)try{r(t._id)}catch(d){console.error(d)}},[s]),e("nav",{className:"NavMain",children:n&&e(N,{children:e("button",{onClick:i,children:"Log-Out"})})})},D=s=>{const[t,n]=l.exports.useState(s);return[t,a=>{n(b(x({},t),{[a.target.name]:a.target.value}))}]},he=()=>{const[{email:s,password:t},n]=D({email:"",password:""}),[i,a]=l.exports.useState(null),r=W(),{storeToken:d,authenticateUser:p}=L(),u=m=>{m.preventDefault(),f.signin({email:s,password:t}).then(h=>{d(h.authToken),p(),r("/")}).catch(h=>{a(h.response.data)})};return o("div",{className:"signinForm",children:[i&&e("h3",{className:"error",children:i.message}),e("h2",{children:"Signin"}),o("form",{onSubmit:u,className:"form1",children:[o("div",{children:[e("label",{htmlFor:"email",children:"Email: "}),e("input",{className:"signinput",type:"email",id:"email",name:"email",onChange:n,value:s,autoComplete:"username"})]}),o("div",{children:[e("label",{htmlFor:"password",children:"Password: "}),e("input",{className:"signinput",type:"password",id:"password",name:"password",onChange:n,value:t,autoComplete:"current-password"})]}),e("button",{className:"btnsub",children:"Submit"})]})]})},me=()=>{const[s,t]=D({name:"",email:"",password:""}),[n,i]=l.exports.useState(null),a=W(),r=d=>{d.preventDefault(),f.signup(s).then(()=>{a("/")}).catch(p=>{i(p)})};return o("div",{className:"signinForm",children:[n&&e("h3",{className:"error",children:n.message}),e("h2",{children:"Signup"}),o("form",{onSubmit:r,className:"form1",children:[o("div",{children:[e("label",{htmlFor:"name",children:"Name :"}),e("input",{className:"signinput",onChange:t,value:s.name,type:"text",id:"name",name:"name"})]}),o("div",{children:[e("label",{htmlFor:"email",children:"Email :"}),e("input",{className:"signinput",onChange:t,value:s.email,type:"email",id:"email",name:"email"})]}),o("div",{children:[e("label",{htmlFor:"password",children:"Password :"}),e("input",{className:"signinput",onChange:t,value:s.password,type:"password",id:"password",name:"password"})]}),e("button",{className:"btnsub",children:"Submit"})]})]})};var pe="data:image/png;base64,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";function ge({clbk:s,avatar:t=""}){const n=j.createRef();return o("div",{className:"is-clickable icon-avatar",title:"change avatar",children:[t&&e("img",{style:{width:250},src:t,alt:"user avatar"}),e("input",{ref:n,type:"file",className:"is-hidden",onChange:s}),e(ee,{onClick:()=>{n.current.click()},className:"is-clickable fa-lg",icon:se})]})}const F=()=>{const{currentUser:s,storeToken:t}=L(),[{name:n,image:i,imageTmp:a},r]=l.exports.useState({name:s.name,image:"",imageTmp:""}),d=s._id,p=h=>{h.persist(),r(v=>b(x({},v),{[h.target.id]:h.target.value}))},u=async h=>{h.preventDefault();const v=new FormData;n!==""&&v.append("name",n),i!==""&&v.append("image",i);try{await f.patch(`/profile/${d}`,v).then(({data:C})=>{t(C.newAuthToken)})}catch(C){console.error(C)}},m=h=>{const v=new FileReader;v.onloadend=()=>{const C=v.result;r(E=>b(x({},E),{image:h,imageTmp:C}))},v.readAsDataURL(h)};return e("div",{className:"profile-edit",children:o("form",{onSubmit:u,onChange:p,children:[e("label",{className:"label",htmlFor:"image"}),e(ge,{avatar:a||(s==null?void 0:s.image),clbk:h=>m(h.target.files[0]),id:"image"}),e("input",{style:{borderRadius:"50px",border:"none",cursor:"pointer"},type:"text",defaultValue:n,id:"name",name:"name"}),e("button",{style:{borderRadius:"50px"},children:"Ok!!"})]})})},ve=()=>{const[s,t]=l.exports.useState(!1),[n,i]=l.exports.useState([]),{isLoggedIn:a}=L(),[r,d]=l.exports.useState(!1),[p,u]=l.exports.useState(!1);return l.exports.useEffect(()=>{f.get("/server/").then(m=>{i(m.data.server)}).catch(m=>console.log(m))},[]),e(N,{children:e("div",{className:"server",children:a?e(N,{children:o("div",{className:"navLP",children:[e("div",{className:"divLogo",children:e(P,{className:"logo",to:"/",children:"IronChat"})}),e("div",{className:"serverContainer",children:n.map((m,h)=>e("div",{className:"serverContainerChild",children:e(te,{to:`/server/${m._id}`,children:e("img",{className:"serverLogo",src:pe,alt:"serverLogo"})},m._id)},h))}),o("div",{className:"homeicone",children:[e("i",{onClick:()=>u(!p),className:"fa-solid fa-plus",style:{fontSize:"30px"}}),e("i",{onClick:()=>d(!r),className:"fas fa-user-circle",style:{fontSize:"30px"}}),p?e("div",{className:"servdiv",children:e(ue,{setServers:i,closeServer:()=>u(!p)})}):null,r?o("div",{className:"profile",children:[e(F,{}),e(X,{})]}):null]})]})}):e(N,{children:e("div",{className:"home",children:s?o(N,{children:[e(me,{}),e("span",{className:"register",onClick:()=>t(!s),children:"Already have an account?"})]}):o(N,{children:[e(he,{}),e("span",{className:"register",onClick:()=>t(!s),children:"Don't have an account?"})]})})})})})},fe=()=>{const{isLoggedIn:s,isLoading:t}=L();return t?e("p",{children:"Loading..."}):s?e(ae,{}):e(ne,{to:"/signin"})};console.log("hop","wss://deploy-ironchat.herokuapp.com");const T=re("wss://deploy-ironchat.herokuapp.com"),Ce=()=>{const[s,t]=l.exports.useState([]),[n,i]=l.exports.useState({}),[a,r]=l.exports.useState(!1),[d,p]=l.exports.useState({}),u=l.exports.useRef(""),m=oe(),{currentUser:h}=L(),[v,C]=l.exports.useState(!1),E=c=>{console.log("je suis fetchmEssage et j'ai recu",c),f.get(`/server/${m.id}/messages`).then(g=>t(g.data.messages)).catch(g=>console.error(g))},J=c=>{console.error("here error backend",c)};l.exports.useEffect(()=>{f.get(`/server/${m.id}`).then(c=>{T.on("error-backend",J),T.on("message-stored",g=>E(g||"pouet")),i(c.data.server)}).catch(c=>console.error(c))},[]),l.exports.useEffect(()=>{E()},[n]);const G=c=>{c.preventDefault();const g=u.current.value;T.emit("message",{serverId:m.id,userId:h._id,content:g}),u.current.value=""},Y=c=>{f.delete(`/server/message/${c}`).then(g=>{const k=s.filter(S=>S._id!==c);t(k)}).catch(g=>console.log(g))},Q=c=>{u.current.value=c.content,u.current.focus(),r(!a),p(c)},V=c=>{c.preventDefault(),r(!a);const g=d._id,k=u.current.value;f.patch(`/server/message/${g}`,{content:k}).then(S=>{const z=JSON.parse(S.config.data).content,B=[];for(let y=0;y<s.length;y++)s[y]._id===g&&(s[y].content=z),B.push(s[y]);u.current.value="",t(B)}).catch(S=>console.log(S))};return o("div",{children:[o("div",{className:"navLP",children:[e("div",{className:"divLogo",children:e(P,{className:"logo",to:"/",children:"IronChat"})}),e("div",{className:"homeicone",children:e("i",{onClick:()=>C(!v),className:"fas fa-user-circle",style:{fontSize:"30px"}})})]}),v?o("div",{className:"profile",children:[e(F,{}),e(X,{})]}):null,o("h1",{children:["Server name: ",n.name]}),e("ul",{id:"messages",children:s.map(c=>o("li",{children:[o("b",{children:[c.userId.name," : "]}),o("div",{children:[c.content,o("div",{className:"message-edit",children:[e("i",{className:"fas fa-trash",onClick:()=>Y(c._id)}),e("i",{className:"fas fa-pencil",onClick:()=>Q(c)})]})]})]},c._id))}),o("form",{id:"form",onSubmit:a?V:G,children:[e("input",{id:"input",autoComplete:"off",ref:u}),e("button",{children:"Send"})]})]})};function Ne(){return e("div",{className:"App",children:o(ie,{children:[e(R,{path:"/",element:e(ve,{})}),o(R,{element:e(fe,{}),children:[e(R,{path:"/server/:id",element:e(Ce,{})}),e(R,{path:"/profile",element:e(F,{})})]})]})})}const Le=({children:s})=>{const[t,n]=l.exports.useState({currentUser:null,isLoading:!0,isLoggedIn:!1});l.exports.useEffect(()=>{i()},[]);const i=()=>{const u=localStorage.getItem("authToken");u?f.isLoggedIn(u).then(m=>{n({currentUser:m,isLoading:!1,isLoggedIn:!0})}).catch(m=>{n({currentUser:null,isLoading:!1,isLoggedIn:!1})}):n({currentUser:null,isLoading:!1,isLoggedIn:!1})},a=()=>{r(),i()},r=()=>{localStorage.removeItem("authToken")},d=u=>{localStorage.setItem("authToken",u),i()},p={currentUser:t.currentUser,isLoading:t.isLoading,isLoggedIn:t.isLoggedIn,removeUser:a,storeToken:d,authenticateUser:i};return e(H.Provider,{value:p,children:s})};le.render(e(j.StrictMode,{children:e(ce,{children:e(Le,{children:e(Ne,{})})})}),document.getElementById("root"));
